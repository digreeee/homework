# Periodic network scanner

__version__ 1.0.1

Набор скриптов на python и bash для периодического сканирования посредством Nmap.

## Description

Текущая версия настроена на TCP, UDP и SCTP сканирования заданного диапазона ip-адресов. В случае отклонений от предварительно сгенерированного baseline скрипт будет отправлять уведомления по e-mail и в специальный чат telegram. Помимо этого, результат ежечасного сканирования, а также ошибки в ходе сканирования, записываются в базу sqlite, с возможностью оперативного ретроспективного поиска информации. Вместе с тем, все данные, сгенерированные в ходе сканирований, сохраняются в сжатом виде в специальных директориях, именованых по датам.

## Installation

Предусмотрена возможность автоматизированного развертывания посредством Ansible.

### Deploy new server

1. Развернуть новый сервер под управлением Debian 8.x;
2. Разрешить доступ по паролю или ключу какого-либо пользователя, состоящего в sudoers.

### Preconfigure new server

Предварительное конфигурирование нового узла (установка сервисов, софта) можно произвести посредством Ansible:

1. Необходимо добавить данные для подключения к новому узлу в `ansible/hosts`;
2. Сгенерировать новые ssh-ключи для нового узла и добавить их в `ansible/public_keys`;
3. Исполнить `ansible playbook`:
```
ansible-playbook -i hosts playbook.yml --ask-become-pass
```

## Usage

Для начала использования необходимо:

- настроить и протестировать отправку сообщений посредством консольной утилиты `mail`;
- внести корректные данные в файл `config/config.sh`;
- создать задачу в крон посредством `crontab` от низкопривилегированного пользователя:
```
PATH="/usr/local:/usr/local/bin:/usr/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin"
30 * * * * cd /opt/scanner/bin/ && bash ./periodic_net_scanner.sh
```
- после того как в параметры сканирования были внесены все необходимые ключи, необходимо пересоздать файл `baseline/scan_baseline.xml`, проведя сканирование и зафиксировав значения, отклонения от которых будут отслеживаться;
- проверить корректность создания файлов `result.db` и архивов с xml-файлами, содержащими результы сканирования;
- проверить корректность отправки уведомлений в случае ошибок в ходе проведения сканирования или в случае обнаружения отклонений от `baseline`.

## Наша конфигурация

Данная утилита развернута на сервер scanner@157.230.21.126 -p 1703.
Сканирование выполняется дважды в сутки. Для контроля за состояние конфигурации,
используется inotify и скрипт bigbro.sh
